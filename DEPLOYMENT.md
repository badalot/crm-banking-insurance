# üöÄ Guide de D√©ploiement - NSIA CRM

Ce guide vous accompagne pas √† pas pour d√©ployer le CRM sur Railway (backend) et Vercel (frontend).

## üìã Pr√©requis

- ‚úÖ Compte GitHub
- ‚úÖ Compte Railway (https://railway.app)
- ‚úÖ Compte Vercel (https://vercel.com)
- ‚úÖ Code pouss√© sur GitHub

---

## üîß 1. Setup GitHub

### Initialiser Git et pousser le code

```bash
cd /home/anna/Documents/crm

# Initialiser Git
git init

# Ajouter tous les fichiers
git add .

# Premier commit
git commit -m "Initial commit - NSIA CRM setup"

# Cr√©er le repo sur GitHub (via l'interface web)
# Puis lier le repo local :
git remote add origin https://github.com/VOTRE-USERNAME/nsia-crm.git
git branch -M main
git push -u origin main
```

---

## üöÇ 2. D√©ploiement Backend sur Railway

### √âtape 1 : Cr√©er un nouveau projet

1. Aller sur https://railway.app
2. Cliquer sur **"New Project"**
3. Choisir **"Deploy from GitHub repo"**
4. S√©lectionner votre repo `nsia-crm`
5. Railway d√©tecte automatiquement le backend Python

### √âtape 2 : Ajouter PostgreSQL

1. Dans votre projet Railway, cliquer sur **"+ New"**
2. Choisir **"Database" ‚Üí "PostgreSQL"**
3. Railway g√©n√®re automatiquement `DATABASE_URL`

### √âtape 3 : Ajouter Redis

1. Cliquer sur **"+ New"**
2. Choisir **"Database" ‚Üí "Redis"**
3. Railway g√©n√®re automatiquement `REDIS_URL`

### √âtape 4 : Configurer les Variables d'Environnement

Dans le service backend, aller dans **"Variables"** et ajouter :

```env
# G√©n√©r√© automatiquement par Railway
DATABASE_URL=<auto-generated>
REDIS_URL=<auto-generated>

# √Ä ajouter manuellement
SECRET_KEY=<g√©n√©rer-une-cl√©-forte-32-chars>
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
ENVIRONMENT=production
PROJECT_NAME=NSIA CRM API
API_V1_PREFIX=/api/v1
```

### √âtape 5 : Configurer CORS (important!)

Ajouter la variable :
```env
BACKEND_CORS_ORIGINS=["https://votre-app.vercel.app"]
```
(On mettra l'URL Vercel apr√®s le d√©ploiement frontend)

### √âtape 6 : D√©ployer

1. Railway d√©ploie automatiquement
2. Noter l'URL publique : `https://votre-projet.railway.app`
3. Tester : `https://votre-projet.railway.app/health`

---

## ‚ñ≤ 3. D√©ploiement Frontend sur Vercel

### √âtape 1 : Importer le projet

1. Aller sur https://vercel.com
2. Cliquer sur **"Add New" ‚Üí "Project"**
3. Importer depuis GitHub : `nsia-crm`

### √âtape 2 : Configurer le projet

**‚ö†Ô∏è IMPORTANT : Configuration sp√©ciale pour monorepo**

Dans les settings d'import :
- **Root Directory** : `frontend` ‚Üê IMPORTANT!
- **Framework Preset** : Next.js
- **Build Command** : `npm run build` (par d√©faut)
- **Output Directory** : `.next` (par d√©faut)
- **Install Command** : `npm install` (par d√©faut)

### √âtape 3 : Variables d'Environnement

Ajouter dans **"Environment Variables"** :

```env
NEXT_PUBLIC_API_URL=https://votre-projet.railway.app
```

Utiliser l'URL Railway de l'√©tape 2.

### √âtape 4 : D√©ployer

1. Cliquer sur **"Deploy"**
2. Vercel build et d√©ploie automatiquement
3. Noter l'URL : `https://votre-app.vercel.app`

### √âtape 5 : Mettre √† jour CORS sur Railway

1. Retourner sur Railway
2. Dans les variables du backend, mettre √† jour :
```env
BACKEND_CORS_ORIGINS=["https://votre-app.vercel.app","https://votre-app-*.vercel.app"]
```
3. Railway red√©ploie automatiquement

---

## ‚úÖ 4. V√©rification

### Test Backend

```bash
# Health check
curl https://votre-projet.railway.app/health

# API Root
curl https://votre-projet.railway.app/

# API Docs
# Ouvrir dans le navigateur :
https://votre-projet.railway.app/docs
```

### Test Frontend

1. Ouvrir `https://votre-app.vercel.app`
2. V√©rifier que les deux statuts sont verts :
   - ‚úÖ Frontend : Actif
   - ‚úÖ Backend API : Actif

---

## üîÑ 5. D√©ploiement Continu (CI/CD)

Une fois configur√©, les d√©ploiements sont automatiques :

### Backend (Railway)
```bash
git add .
git commit -m "Backend changes"
git push
# ‚Üí Railway d√©tecte et red√©ploie automatiquement
```

### Frontend (Vercel)
```bash
git add .
git commit -m "Frontend changes"  
git push
# ‚Üí Vercel d√©tecte et red√©ploie automatiquement
```

---

## üõ†Ô∏è 6. Commandes Utiles

### Logs Backend (Railway)

1. Dans le dashboard Railway
2. Cliquer sur le service backend
3. Onglet **"Deployments"** ‚Üí Voir les logs

### Logs Frontend (Vercel)

1. Dans le dashboard Vercel
2. Cliquer sur le projet
3. Onglet **"Deployments"** ‚Üí Cliquer sur un d√©ploiement ‚Üí Logs

### G√©n√©rer une SECRET_KEY forte

```bash
# Python
python -c "import secrets; print(secrets.token_urlsafe(32))"

# OpenSSL
openssl rand -base64 32
```

---

## üö® Troubleshooting

### Backend ne d√©marre pas
- V√©rifier que `DATABASE_URL` et `REDIS_URL` sont bien d√©finis
- V√©rifier les logs Railway
- V√©rifier que le health check `/health` r√©pond

### Frontend ne se connecte pas au backend
- V√©rifier `NEXT_PUBLIC_API_URL` dans Vercel
- V√©rifier `BACKEND_CORS_ORIGINS` dans Railway
- Ouvrir la console navigateur pour voir les erreurs CORS

### Base de donn√©es vide
- Se connecter √† PostgreSQL via Railway
- Cr√©er les tables manuellement (on ajoutera Alembic migrations plus tard)

---

## üìä URLs Finales

Une fois d√©ploy√©, noter vos URLs :

- **Frontend** : https://votre-app.vercel.app
- **Backend API** : https://votre-projet.railway.app
- **API Docs** : https://votre-projet.railway.app/docs
- **GitHub Repo** : https://github.com/VOTRE-USERNAME/nsia-crm

---

## üéâ Prochaines √âtapes

‚úÖ D√©ploiement initial termin√© !

Maintenant on peut commencer √† impl√©menter les fonctionnalit√©s :
1. Module Auth & Users
2. Gestion Clients 360¬∞
3. KYC/AML
4. Dashboard Analytics
5. ... etc.

Chaque push sur `main` d√©clenchera automatiquement les d√©ploiements ! üöÄ
